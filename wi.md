# Установка карт из Workshop

*Workshop (Мастерская Steam)* - это сервис Steam, позволяющий разработчикам загружать свои карты, модели и прочие ресурсы для общего пользования.
Пример будет рассмотрен на установке карт из Workshop на сервер Counter-Strike: Global Offensive.

**Шаг 1. Создание ключа к Steam WebAPI.**

Первым делом нужно получить собственный ключ к Steam WebAPI. Для этого перейдите на [сайт steam](http://steamcommunity.com/dev/apikey).<br>
В открывшейся странице, войдите в свою учетную запись Steam.<br>
***Рисунок 1. Вход в учетную запись Steam.***

В окне регистрации нового ключа, в поле Домен введите свой адрес электронной почты и поставьте галочку, подтверждая свое согласие с правилами пользования.<br>
Нажмите Зарегистрировать.<br>
***Рисунок 2. Регистрация нового Steam WebAPI ключа.***

На новой странице Вы увидите свою ключ от WebAPI, его нужно скопировать.<br>
***Рисунок 3. Копирование своего WebAPI ключа.***

Зайдите в панель управления игровым сервером, в разделе Конфиги откройте редактирование файла webapi_authkey.txt
Вставьте в него свой WebAPI ключ и сохраните файл.<br>
***Рисунок 4. Редактирование файла webapi_authkey.txt***


**Шаг 2. Настройка коллекции карт в Мастерской.**

В Мастерской найдите или создайте нужную вам группу карт (на забудьте опубликовать созданную вами коллекцию карт, для проверки зайдите с анонимной вкладки вашего браузера по ссылке на вашу коллекцию, если её видно - значит опубликована, если ошибка, значит не опубликована). Зайдите в нее и скопируйте ее номер из адресной строки браузера. Этот номер будет использоваться для параметра host_workshop_collection.
Для примера рассмотрим популярный набор _se карт.<br>
***Рисунок 5. Коллекция _se карт.***

Далее нужно скопировать номер карты, которая будет выставлена на сервере как стартовая. В выбранной или созданной коллекции в Мастерской, откройте нужную вам карту и скопируйте номер карты из адресной строки браузера. Этот номер будет использоваться для параметра workshop_start_map.<br>
***Рисунок 6. Карта de_dust2_se в мастерской.***

В панели управления игрового сервера в разделе Конфиги откройте файл autoexec.cfg и впишите в него полученные параметры:
```
host_workshop_collection 125499590
workshop_start_map 125488374
```
Соответственно, цифры в параметрах у вас должны быть свои, которые вы скопировали ранее.<br>
Чтобы запретить игрокам ставить любые карты из Мастерской впишите следующий параметр:
```
sv_workshop_allow_other_maps 0
```

Сохраните файл, перезапустите игровой сервер.<br>
***Рисунок 7. Сохранение параметров в autoexec.cfg***
***Рисунок 8. Сохранение параметров в autoexec.cfg***

После перезапуска, сервер автоматически скачает новые карты из Мастерской и поставит стартовой карту ту, номер которой вы указали в параметре workshop_start_map. Игрокам при входе на Ваш сервер будет автоматически закачана карта в папку с игрой, поэтому не нужно заботиться о создании собственного контент-хостинга для быстрого скачивания.

**Шаг 3. Настройка ротации карт на сервере.**<br>
Для того, чтобы отключить встроенное в игру голосование за новую карту и использовать голосование от SourceMod, в дополнительные параметры в разделе Конфиг впишите mp_endmatch_votenextmap 0
Теперь настроим ротацию карт. В разделе Конфиги откройте файл mapcycle.txt, для использования карт из Мастерской, в данный файл нужно вписывать карты в формате: workshop/id_карты/название_карты
Для приведенного выше примера с группой `_se` карт, данный файл будет выглядеть так:
```
workshop/125488374/de_dust2_se
workshop/125498231/de_train_se
workshop/125499116/de_inferno_se
workshop/125498553/de_nuke_se
```
***Рисунок 9. Настройка ротации карт в mapcycle.txt***
***Рисунок 10. Настройка ротации карт в mapcycle.txt***

Список карт, который будет отображаться в меню администратора нужно настраивать аналогичным образом.
Сохраните настройки, выключите игровой сервер.<br>
После чего можете включить игровой сервер, он скачает карты из Мастерской и запустит их. 